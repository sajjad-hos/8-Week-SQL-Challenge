## Case Study #6 - Clique Bait - 1. Digital Analysis | Questions | Solutions | Result

#### Q1: How many users are there?
#### ðŸ§  My Approach & Solution:

- Counted unique `user_id` for total users.

````sql
SELECT COUNT(DISTINCT user_id) AS total_users
FROM clique_bait.users;
  ````

#### ðŸ“Š Query Result & Insights:
| total_users |
| ----------- |
| 500         |

- There are a total of 500 users!
---
#### Q2: How many cookies does each user have on average?
#### ðŸ§  My Approach & Solution:
- Counted total cookies and total users
- Divided cookies by users to find the average
- Rounded where needed for whole numbers.

````sql
SELECT 
    COUNT(DISTINCT user_id) AS total_users,
    COUNT(cookie_id) AS total_cookies,
    COUNT(cookie_id)::FLOAT / COUNT(DISTINCT user_id) AS average_cookies,
    ROUND(COUNT(cookie_id)::FLOAT / COUNT(DISTINCT user_id)) AS average_cookies_rounded
FROM clique_bait.users;
  ````

#### ðŸ“Š Query Result & Insights:
| total_users | total_cookies | average_cookies | average_cookies_rounded |
| ----------- | ------------- | --------------- | ----------------------- |
| 500         | 1782          | 3.564           | 4                       |

- If cookies are shared equally, then each user would get about 3.56 cookies on average.
- Since I canâ€™t split cookies in practice, if users only receive whole cookies, each user would get 4 cookies (rounding up).

---
#### Q3: What is the unique number of visits by all users per month?
#### ðŸ§  My Approach & Solution:
- First, extract the month from event_time to get the numeric month number for group by.
- Then it counts unique visits per month.

````sql
SELECT 
    EXTRACT(MONTH FROM event_time) AS month,
    COUNT(DISTINCT visit_id) AS unique_visits
FROM clique_bait.events
GROUP BY month
ORDER BY month;
  ````

#### ðŸ“Š Query Result & Insights:
| month | unique_visits |
| ----- | ------------- |
| 1     | 876           |
| 2     | 1488          |
| 3     | 916           |
| 4     | 248           |
| 5     | 36            |

- In January, there were 876 unique visits, marking the initial user activity.
- In February, unique visits peaked at 1488, the highest in the period.
- In March, visits declined slightly to 916, but activity was still strong.
- In April, visits dropped sharply to 248, showing a major decline in engagement.
- In May, visits fell further to just 36, indicating very low user activity.

---
#### Q4: What is the number of events for each event type?
#### ðŸ§  My Approach & Solution:
- Grouped the events by their type and counted the number of occurrences for each type to find how many events belong to each category.

````sql
SELECT event_type, COUNT(event_type) AS total_events
FROM clique_bait.events
GROUP BY event_type
ORDER BY total_events DESC;
  ````

#### ðŸ“Š Query Result & Insights:
| event_type | total_events |
| ---------- | ------------ |
| 1          | 20928        |
| 2          | 8451         |
| 3          | 1777         |
| 4          | 876          |
| 5          | 702          |

- Event type 1 occurred 20928 times, making it the most frequent activity.
- Event type 2 occurred 8451 times, less than half of event type 1.
- Event type 3 occurred 1777 times, showing a significant drop compared to earlier event types.
- Event type 4 occurred 876 times, indicating much lower engagement.
- Event type 5 occurred 702 times, the least frequent activity overall.

---
#### Q5: What is the percentage of visits which have a purchase event?
#### ðŸ§  My Approach & Solution:
- Performed an inner join between events and event_identifier to filter for purchase events.
- Counted total purchase occurrences and total distinct visits across all events.
- Calculated the percentage of visits with at least one purchase by dividing distinct purchase visits by total visits
- Multiplied by 100.0, and rounded to two decimal places.

````sql
SELECT
    ei.event_name,
    COUNT(e.event_type) AS number_events,
    (SELECT COUNT(DISTINCT visit_id) FROM clique_bait.events) AS total_visits,
    ROUND(100.0 * COUNT(DISTINCT e.visit_id) / (SELECT COUNT(DISTINCT visit_id) FROM clique_bait.events), 2) AS percent_visit
FROM clique_bait.events e
INNER JOIN clique_bait.event_identifier ei ON e.event_type = ei.event_type
WHERE ei.event_name = 'Purchase'
GROUP BY ei.event_name;
  ````

#### ðŸ“Š Query Result & Insights:
| event_name | number_events | total_visits | percent_visit |
| ---------- | ------------- | ------------ | ------------- |
| Purchase   | 1777          | 3564         | 49.86         |

- Out of 3564 total visits, 1777 included a purchase event, meaning 49.86% of all visits led to a purchase!

---
#### Q6: What is the percentage of visits which view the checkout page but do not have a purchase event?
#### ðŸ§  My Approach & Solution:
- Filtered the events to include only checkouts (page_id = 12 AND event_type = 1) and purchases (event_type = 3).
- Counted the total checkouts and total purchases.
- Calculated 1 - (purchases Ã· checkouts) and multiply by 100 to get the percentage of checkouts without a purchase.

````sql
SELECT ROUND(100 * (1 - (
          SUM(CASE WHEN event_type = 3 THEN 1 ELSE 0 END)::NUMERIC /
          SUM(CASE WHEN page_id = 12 AND event_type = 1 THEN 1 ELSE 0 END)
          )), 2) AS percent_checkout_without_purchase
FROM clique_bait.events
WHERE page_id = 12 AND event_type = 1 OR event_type = 3;
  ````

#### ðŸ“Š Query Result & Insights:
| percent_checkout_without_purchase |
| --------------------------------- |
| 15.50                             |

- 15.5% of visits went to the checkout page but didnâ€™t make a purchase!

---
#### Q7: What are the top 3 pages by number of views?
#### ðŸ§  My Approach & Solution:
- Counted the number of views per page using COUNT(ph.page_name).
- Ensured the aggregate was correctly done per page using GROUP BY ph.page_id, ph.page_name.
- Sorted from most to least viewed using ORDER BY number_of_views DESC .
- Returned the top 3 pages using LIMIT 3.

````sql
SELECT ph.page_id, ph.page_name, COUNT(ph.page_name) AS number_of_views
FROM clique_bait.events e
INNER JOIN clique_bait.page_hierarchy ph ON e.page_id = ph.page_id
WHERE e.event_type = 1
GROUP BY ph.page_id, ph.page_name
ORDER BY number_of_views DESC
LIMIT 3;
  ````

#### ðŸ“Š Query Result & Insights:
| page_id | page_name    | number_of_views |
| ------- | ------------ | --------------- |
| 2       | All Products | 3174            |
| 12      | Checkout     | 2103            |
| 1       | Home Page    | 1782            |

- The pages with the most views are All Products (3174 views), Checkout (2103 views), and Home Page (1782 views).

---
#### Q8: What is the number of views and cart adds for each product category?
#### ðŸ§  My Approach & Solution:
- Joined the tables and filtered out rows with null product categories.
- Counted page views and cart adds separately for each product category.
- Grouped the results by product category to show total views and cart adds per category.

````sql
SELECT 
    ph.product_category,
    COUNT(*) FILTER (WHERE ei.event_name = 'Page View') AS number_of_views,
    COUNT(*) FILTER (WHERE ei.event_name = 'Add to Cart') AS number_of_cart_adds
FROM clique_bait.events e
INNER JOIN clique_bait.event_identifier ei 	ON e.event_type = ei.event_type
INNER JOIN clique_bait.page_hierarchy ph 	ON e.page_id = ph.page_id
WHERE ph.product_category IS NOT NULL
GROUP BY ph.product_category;
  ````

#### ðŸ“Š Query Result & Insights:
| product_category | number_of_views | number_of_cart_adds |
| ---------------- | --------------- | ------------------- |
| Luxury           | 3032            | 1870                |
| Shellfish        | 6204            | 3792                |
| Fish             | 4633            | 2789                |

- The Luxury category had 3032 views and 1870 cart adds.
- The Shellfish category had 6204 views and 3792 cart adds.
- The Fish category had 4633 views and 2789 cart adds.

---
#### Q9: What are the top 3 products by purchases?
#### ðŸ§  My Approach & Solution:
- Identified visits with purchases using a CTE to retrieve all visit_ids where a purchase occurred.
Retrieved items added to the cart during those visits by joining events with the purchased visits and filtering for Add to Cart events.
Aggregated and ranked products by counting the number of cart adds per product, grouping by product, and selecting the top 3 most purchased items.

````sql
WITH purchased_visits AS (
    SELECT e.visit_id
    FROM clique_bait.events e
    INNER JOIN clique_bait.event_identifier ei ON e.event_type = ei.event_type
    WHERE ei.event_name = 'Purchase'
)

SELECT 
	  ph.product_id, 
      ph.page_name, 
      COUNT(ph.page_name) AS purchase_item
FROM clique_bait.events e
INNER JOIN purchased_visits pv ON e.visit_id = pv.visit_id
INNER JOIN clique_bait.page_hierarchy ph 	ON e.page_id = ph.page_id
INNER JOIN clique_bait.event_identifier ei 	ON e.event_type = ei.event_type
WHERE ph.product_category IS NOT NULL   AND ei.event_name = 'Add to Cart'
GROUP BY ph.product_id, ph.page_name
ORDER BY purchase_item DESC
LIMIT 3;
  ````

#### ðŸ“Š Query Result & Insights:
| product_id | page_name | purchase_item |
| ---------- | --------- | ------------- |
| 7          | Lobster   | 754           |
| 9          | Oyster    | 726           |
| 8          | Crab      | 719           |

- The three most purchased products are Lobster (754 purchases), Oyster (726 purchases), and Crab (719 purchases).

---
